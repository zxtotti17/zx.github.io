---
title: 充值流程
date: 2019-03-06 20:01:38
tags:
---

接触到的充值流程是这样的
客户端发起请求->lcm后台，lcm后台确认充值成功，会将充值的金额变成平台货币保存在平台端，并通知到客户端充值成功，
收到充值成功的客户端对游戏服务端发起请求，游戏服务端收到请求后，请求lcm平台调用spend方法，平台确认信息相符就扣币
并告诉游戏服务端消费成功，游戏服务端在将平台货币转换为对应的游戏币，同时告诉客户端充值成功

2.平台充值成功可能会产生回调直接通知游戏服务端，服务端接收请求，后请求平台spend，成功后发币记录，客户端请求服务端查到有记录就告知客户端成功不做spend

掉单：
如果掉单
1.平台回调请求会保证执行spend方法，达到补单的效果
2.客户端能读到平台币，直接通过平台剩余币与游戏服务端直接交易

注意：
任何时间判断以天为单位要特别小心，如果出现两版批次连续很容易出问题