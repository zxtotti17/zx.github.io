{"title":"游戏运营活动框架思路","slug":"游戏运营活动框架思路","date":"2019-11-22T08:15:07.000Z","updated":"2019-11-27T15:26:48.000Z","comments":true,"path":"api/articles/游戏运营活动框架思路.json","photos":[],"link":"","excerpt":"游戏的运营活动一般会有好多种类型，但是这些类型的功能一般是有共同和非共同的部分，这里记录一个对多类型运营活动的管理框架<br>通过模板表录入运营活动的参数，包括跳转模块，开启方法，红点方法，等级等。如果有类似活动结束发奖的奖励表也可以用表来记录不同活动operation_id对应的奖励<br>进行管理。<br> [Figure] ","covers":["1574411899.jpg"],"content":"<p>游戏的运营活动一般会有好多种类型，但是这些类型的功能一般是有共同和非共同的部分，这里记录一个对多类型运营活动的管理框架<br>通过模板表录入运营活动的参数，包括跳转模块，开启方法，红点方法，等级等。如果有类似活动结束发奖的奖励表也可以用表来记录不同活动operation_id对应的奖励<br>进行管理。<br><img src=\"1574411899.jpg\" alt=\"1574411899\"><br>1.初始化玩家排行<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">init_sky_bless_rank() -&gt;</span><br><span class=\"line\">    List = [PlayerSkyBless || PlayerSkyBless &lt;- get_all_player_st_sky_bless(),</span><br><span class=\"line\">        PlayerSkyBless <span class=\"comment\">#player_st_sky_bless.bless_times &gt; 0],</span></span><br><span class=\"line\">    SortFunction = fun(A,B) -&gt;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>  A <span class=\"comment\">#player_st_sky_bless.bless_times =:= B #player_st_sky_bless.bless_times -&gt;</span></span><br><span class=\"line\">                A <span class=\"comment\">#player_st_sky_bless.last_time =&lt; B #player_st_sky_bless.last_time;</span></span><br><span class=\"line\">            <span class=\"literal\">true</span> -&gt;</span><br><span class=\"line\">                A <span class=\"comment\">#player_st_sky_bless.bless_times &gt; B #player_st_sky_bless.bless_times</span></span><br><span class=\"line\">        end</span><br><span class=\"line\">    end,</span><br><span class=\"line\">    SortList = lists:sort(SortFunction,List),</span><br><span class=\"line\">    Num = length(SortList),</span><br><span class=\"line\">    Tran = fun() -&gt;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>  Num &gt; 0 -&gt;</span><br><span class=\"line\">                lists:foreach(</span><br><span class=\"line\">                    fun(Seq) -&gt;</span><br><span class=\"line\">                        PlayerSkyBless = lists:nth(Seq,SortList),</span><br><span class=\"line\">                        lib_ets:insert(sky_bless_player_ranking,<span class=\"comment\">#sky_lantern_bless_player_ranking&#123;</span></span><br><span class=\"line\">                            player_id = PlayerSkyBless <span class=\"comment\">#player_st_sky_bless.player_id,ranking = Seq&#125;,replace),</span></span><br><span class=\"line\">                        BlessRanking = <span class=\"comment\">#sky_lantern_bless_ranking&#123;</span></span><br><span class=\"line\">                            ranking = Seq,</span><br><span class=\"line\">                            player_id = PlayerSkyBless <span class=\"comment\">#player_st_sky_bless.player_id,</span></span><br><span class=\"line\">                            <span class=\"built_in\">times</span>   = PlayerSkyBless <span class=\"comment\">#player_st_sky_bless.bless_times,</span></span><br><span class=\"line\">                            bless_time = PlayerSkyBless <span class=\"comment\">#player_st_sky_bless.last_time</span></span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        lib_ets:insert(sky_bless_ranking,BlessRanking,replace)</span><br><span class=\"line\">                    end,</span><br><span class=\"line\">                    lists:seq(1,Num)</span><br><span class=\"line\">                );</span><br><span class=\"line\">            <span class=\"literal\">true</span> -&gt;</span><br><span class=\"line\">                noop</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end,</span><br><span class=\"line\">    game_db:<span class=\"keyword\">do</span>(Tran).</span><br></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<p>2.处理玩家排行<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deal_update_player_ranking(PlayerId) -&gt;</span><br><span class=\"line\">    PlayerSkyBless = get_player_st_sky_bless(PlayerId),</span><br><span class=\"line\">    BlessTimes = PlayerSkyBless <span class=\"comment\">#player_st_sky_bless.bless_times,</span></span><br><span class=\"line\">    BlessTime  = PlayerSkyBless <span class=\"comment\">#player_st_sky_bless.last_time,</span></span><br><span class=\"line\">    NowRanking = get_sky_bless_player_ranking(PlayerId),</span><br><span class=\"line\">    Tran = fun() -&gt;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>  NowRanking == 0 -&gt;</span><br><span class=\"line\">                Len = length(get_all_sky_bless_ranking()),</span><br><span class=\"line\">                NewRanking = <span class=\"comment\">#sky_lantern_bless_ranking&#123;</span></span><br><span class=\"line\">                    ranking     = Len + 1,</span><br><span class=\"line\">                    player_id   = PlayerId,</span><br><span class=\"line\">                    <span class=\"built_in\">times</span>       = BlessTimes,</span><br><span class=\"line\">                    bless_time  = BlessTime</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                lib_ets:insert(sky_bless_ranking,NewRanking,replace),</span><br><span class=\"line\">                lib_ets:insert(sky_bless_player_ranking,<span class=\"comment\">#sky_lantern_bless_player_ranking&#123;</span></span><br><span class=\"line\">                    player_id = PlayerId,ranking = Len + 1&#125;,replace),</span><br><span class=\"line\">                ranking_sort(PlayerId,BlessTimes,BlessTime,Len);</span><br><span class=\"line\">            <span class=\"literal\">true</span> -&gt;</span><br><span class=\"line\">                lib_ets:update(sky_bless_ranking,NowRanking,[&#123;<span class=\"comment\">#sky_lantern_bless_ranking.times,BlessTimes&#125;,</span></span><br><span class=\"line\">                    &#123;<span class=\"comment\">#sky_lantern_bless_ranking.bless_time,BlessTime&#125;]),</span></span><br><span class=\"line\">                ranking_sort(PlayerId,BlessTimes,BlessTime,NowRanking - 1)</span><br><span class=\"line\">        end</span><br><span class=\"line\">    end,</span><br><span class=\"line\">    game_db:<span class=\"keyword\">do</span>(Tran).</span><br><span class=\"line\"></span><br><span class=\"line\">ranking_sort(_,_,_,0) -&gt;</span><br><span class=\"line\">    noop;</span><br><span class=\"line\"></span><br><span class=\"line\">ranking_sort(PlayerId,BlessTimes,Time,Ranking) -&gt;</span><br><span class=\"line\">    BlessRanking = get_sky_bless_ranking(Ranking),</span><br><span class=\"line\">    <span class=\"keyword\">case</span> sort(BlessTimes,Time,BlessRanking <span class=\"comment\">#sky_lantern_bless_ranking.times,BlessRanking #sky_lantern_bless_ranking.bless_time) of</span></span><br><span class=\"line\">        <span class=\"literal\">true</span> -&gt;</span><br><span class=\"line\">            NewRanking = <span class=\"comment\">#sky_lantern_bless_ranking&#123;</span></span><br><span class=\"line\">                ranking = Ranking,</span><br><span class=\"line\">                player_id = PlayerId,</span><br><span class=\"line\">                <span class=\"built_in\">times</span>   = BlessTimes,</span><br><span class=\"line\">                bless_time = Time</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            ARanking = <span class=\"comment\">#sky_lantern_bless_ranking&#123;</span></span><br><span class=\"line\">                ranking = Ranking + 1,</span><br><span class=\"line\">                player_id = BlessRanking <span class=\"comment\">#sky_lantern_bless_ranking.player_id,</span></span><br><span class=\"line\">                <span class=\"built_in\">times</span> = BlessRanking <span class=\"comment\">#sky_lantern_bless_ranking.times,</span></span><br><span class=\"line\">                bless_time = BlessRanking <span class=\"comment\">#sky_lantern_bless_ranking.bless_time</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            lib_ets:insert(sky_bless_player_ranking,<span class=\"comment\">#sky_lantern_bless_player_ranking&#123;</span></span><br><span class=\"line\">                player_id = BlessRanking <span class=\"comment\">#sky_lantern_bless_ranking.player_id,ranking = Ranking + 1&#125;,replace),</span></span><br><span class=\"line\">            lib_ets:insert(sky_bless_player_ranking,<span class=\"comment\">#sky_lantern_bless_player_ranking&#123;</span></span><br><span class=\"line\">                player_id = PlayerId,ranking = Ranking&#125;,replace),</span><br><span class=\"line\">            lib_ets:insert(sky_bless_ranking,NewRanking,replace),</span><br><span class=\"line\">            lib_ets:insert(sky_bless_ranking,ARanking,replace),</span><br><span class=\"line\">            ranking_sort(PlayerId,BlessTimes,Time,Ranking - 1);</span><br><span class=\"line\">        <span class=\"literal\">false</span> -&gt;</span><br><span class=\"line\">            noop</span><br><span class=\"line\">    end.</span><br></pre></td></tr></table></figure></p>\n<p>3.通过公共管理进程对活动进行管理发奖及消息通知<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">handle_cast(&#123;async_send&#125;, &#123;<span class=\"literal\">true</span>,State&#125;) -&gt;</span><br><span class=\"line\">    catch api_st_sky_bless:timer_notify(State),</span><br><span class=\"line\">    start_timer(1),</span><br><span class=\"line\">    &#123;noreply, &#123;<span class=\"literal\">true</span>,[]&#125;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">handle_cast(&#123;activity_stop&#125;,State) -&gt;</span><br><span class=\"line\">    mod_st_sky_bless:give_award(),</span><br><span class=\"line\">    &#123;noreply,State&#125;;</span><br></pre></td></tr></table></figure></p>\n","categories":[],"tags":[{"name":"游戏","slug":"游戏","count":3,"path":"api/tags/游戏.json"}]}